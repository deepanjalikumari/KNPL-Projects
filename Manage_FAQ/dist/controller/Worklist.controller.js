sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,i,o){"use strict";return e.extend("com.knpl.pragati.Manage_FAQ.controller.Worklist",{formatter:r,onInit:function(){var e,r,i=this.byId("table");r=i.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0,filterBar:{FAQCategoryId:"",FAQSubcategoryId:"",Search:""},hasFAQSubcategory:false});this.setModel(e,"worklistView");var o=this;i.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",r);var t=o.getModel();t.callFunction("/GetLoggedInAdmin",{method:"GET",success:function(t){e.setProperty("/loggedUserId",t.results[0].Id);e.setProperty("/loggedUserRoleId",t.results[0].RoleId)}})});this._addSearchFieldAssociationToFB()},_addSearchFieldAssociationToFB:function(){let e=this.getView().byId("filterbar");let t=e.getBasicSearch();var r;var i=this;if(!t){r=new sap.m.SearchField({value:"{worklistView>/filterBar/Search}",showSearchButton:true,search:i.onSearch.bind(i)})}else{t=null}e.setBasicSearch(r)},onFAQCategoryChange:function(e){var t=this.getModel("worklistView");var r=[];var a=e.getSource().getSelectedKey();if(a){t.setProperty("/hasFAQSubcategory",e.getSource().getSelectedItem().getBindingContext().getObject().HasSubcategory);if(e.getSource().getSelectedItem().getBindingContext().getObject().HasSubcategory===true){var s=this.getView().byId("idFAQSubCategory");var n=s.getBinding("items");s.clearSelection();s.setValue("");r.push(new i("IsArchived",o.EQ,false));r.push(new i("FAQCategoryId",o.EQ,a));n.filter(r)}}else{t.setProperty("/hasFAQSubcategory",false)}},onUpdateFinished:function(e){var t,r=this.getView().byId("table"),i=e.getParameter("total");if(i&&r.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[i])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onReset:function(){this._ResetFilterBar()},_ResetFilterBar:function(){var e=[];var t={FAQCategoryId:"",FAQSubcategoryId:"",searchBar:""};var r=this.getView().getModel("worklistView");r.setProperty("/hasFAQSubcategory",false);r.setProperty("/filterBar",t);var i=this.byId("table");var o=i.getBinding("items");o.filter([])},onPress:function(e){this._showObject(e.getSource())},onNavBack:function(){history.go(-1)},onSearch:function(e){var t=[];var r=this.getView().getModel("worklistView").getProperty("/filterBar");var a=true;debugger;for(let e in r){if(r[e]){console.log(r[e]);if(e==="FAQCategoryId"){a=false;t.push(new i(e,o.EQ,r[e]))}else if(e==="FAQSubcategoryId"){a=false;t.push(new i(e,o.EQ,r[e]))}else if(e==="Search"){a=false;t.push(new i([new i("tolower(Question)",o.Contains,"'"+r[e].trim().toLowerCase().replace("'","''")+"'"),new i("tolower(Answer)",o.Contains,"'"+r[e].trim().toLowerCase().replace("'","''")+"'"),new i("tolower(FAQCategory/FAQCategory)",o.Contains,"'"+r[e].trim().toLowerCase().replace("'","''")+"'"),new i("tolower(FAQSubcategory/FAQSubcategory)",o.Contains,"'"+r[e].trim().toLowerCase().replace("'","''")+"'")],false))}else{a=false;t.push(new i(e,o.Contains,r[e].trim()))}}}var s=new i({filters:t,and:true});var n=this.getView().byId("table");var l=n.getBinding("items");if(!a){l.filter(s)}else{l.filter([])}},getFiltersfromFB:function(){var e=this.getView().byId("filterbar"),t=[];debugger;e.getAllFilterItems().forEach(function(e){if(e.getControl().getSelectedKey()){t.push(new i(e.getName(),o.EQ,e.getControl().getSelectedKey()))}});return t},onAdd:function(e){this.getRouter().navTo("createObject")},onEdit:function(e){this._showObject(e.getSource())},onDelete:function(e){var t=e.getSource().getBindingContext().getPath();function r(){var e=t+"/IsArchived";this.getModel().update(e,{IsArchived:true},{success:this.showToast.bind(this,"MSG_SUCCESS_FAQ_REMOVE")})}this.showWarning("MSG_CONFIRM_DELETE",r)},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Id")})},_applySearch:function(e){var t=this.byId("table"),r=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){r.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}}})});